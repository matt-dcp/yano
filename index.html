<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Casa Yano — Performance Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif; background: #FAF8F4; }
    #root { min-height: 100vh; }
    #loading { display: flex; align-items: center; justify-content: center; height: 100vh;
      font-size: 18px; color: #4A4A4A; flex-direction: column; gap: 12px; }
    #loading .spinner { width: 32px; height: 32px; border: 3px solid #F5F1EB;
      border-top: 3px solid #C6973F; border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="root">
    <div id="loading">
      <div class="spinner"></div>
      <div>Loading Casa Yano Dashboard...</div>
    </div>
  </div>

  <!-- Data (generated by build.py) -->
  <script src="data.js"></script>

  <!-- React + Recharts from CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.24.0/babel.min.js"></script>

  <script type="text/babel" data-type="module">
    const { useState } = React;
    const {
      BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,
      PieChart, Pie, Cell, Legend, LineChart, Line, ComposedChart, Area
    } = Recharts;

    const D = window.__DATA__;
    if (!D) {
      document.getElementById("root").innerHTML =
        '<div style="padding:40px;text-align:center;color:#C44D4D;font-size:18px;">No data loaded. Run <code>python build.py</code> first.</div>';
      throw new Error("No data");
    }

    const COLORS = {
      gold: "#C6973F", goldLight: "#D4AD5E", goldDark: "#A67C2E",
      charcoal: "#2C2C2C", warmGray: "#4A4A4A",
      lightGray: "#F5F1EB", cream: "#FAF8F4", white: "#FFFFFF",
      green: "#4A8C5C", greenLight: "#E8F2EB",
      red: "#C44D4D", redLight: "#F8EDED",
      blue: "#4A6FA5", blueLight: "#EBF0F7",
    };
    const PIE_COLORS = ["#C6973F", "#4A6FA5", "#4A8C5C", "#8B6BAE", "#C47D4D", "#5AABA5", "#999"];

    const fmt = (n) => "$" + Math.round(n).toLocaleString();
    const fmtK = (n) => "$" + (n / 1000).toFixed(0) + "K";

    // ── Shared Components ──
    const KPICard = ({ label, value, sub, accent }) => (
      <div style={{
        background: COLORS.white, borderRadius: 12, padding: "20px 24px",
        boxShadow: "0 1px 3px rgba(0,0,0,0.06)",
        borderLeft: `4px solid ${accent || COLORS.gold}`, minWidth: 0,
      }}>
        <div style={{ fontSize: 12, fontWeight: 600, color: COLORS.warmGray,
          textTransform: "uppercase", letterSpacing: 1, marginBottom: 6 }}>{label}</div>
        <div style={{ fontSize: 28, fontWeight: 700, color: COLORS.charcoal, lineHeight: 1.1 }}>{value}</div>
        {sub && <div style={{ fontSize: 12, color: COLORS.warmGray, marginTop: 4 }}>{sub}</div>}
      </div>
    );

    const SectionTitle = ({ children }) => (
      <h2 style={{
        fontSize: 18, fontWeight: 700, color: COLORS.charcoal,
        borderBottom: `2px solid ${COLORS.gold}`, paddingBottom: 8,
        marginBottom: 20, marginTop: 0,
      }}>{children}</h2>
    );

    const CompBar = ({ label, value, max, format, color, benchmark, benchLabel }) => {
      const pct = (value / max) * 100;
      const bmPct = benchmark ? (benchmark / max) * 100 : null;
      return (
        <div style={{ marginBottom: 14 }}>
          <div style={{ display: "flex", justifyContent: "space-between", fontSize: 13, marginBottom: 4 }}>
            <span style={{ fontWeight: 600, color: COLORS.charcoal }}>{label}</span>
            <span style={{ fontWeight: 700, color: color || COLORS.gold }}>{format ? format(value) : value}</span>
          </div>
          <div style={{ position: "relative", height: 10, background: COLORS.lightGray, borderRadius: 5, overflow: "visible" }}>
            <div style={{ height: "100%", width: `${Math.min(pct, 100)}%`,
              background: color || COLORS.gold, borderRadius: 5, transition: "width 0.5s ease" }} />
            {bmPct && (
              <div style={{ position: "absolute", top: -3, left: `${Math.min(bmPct, 100)}%`,
                width: 2, height: 16, background: COLORS.charcoal, borderRadius: 1 }}>
                <div style={{ position: "absolute", top: -16, left: -20, fontSize: 10,
                  color: COLORS.warmGray, whiteSpace: "nowrap" }}>{benchLabel}</div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const CustomTooltip = ({ active, payload, label }) => {
      if (!active || !payload?.length) return null;
      return (
        <div style={{
          background: COLORS.white, border: `1px solid ${COLORS.lightGray}`,
          borderRadius: 8, padding: "10px 14px", boxShadow: "0 4px 12px rgba(0,0,0,0.1)",
        }}>
          <div style={{ fontWeight: 700, fontSize: 13, marginBottom: 4 }}>{label}</div>
          {payload.map((p, i) => (
            <div key={i} style={{ fontSize: 12, color: p.color, display: "flex", gap: 8 }}>
              <span>{p.name}:</span>
              <span style={{ fontWeight: 600 }}>{typeof p.value === "number" && Math.abs(p.value) > 100 ? fmt(Math.abs(p.value)) : p.value}</span>
            </div>
          ))}
        </div>
      );
    };

    // ── Main Dashboard ──
    function CasaYanoDashboard() {
      const [tab, setTab] = useState("overview");
      const S = D.summary;
      const PF = D.proForma;

      // Add colors to source data
      const sourceData = D.sourceData.map((s, i) => ({ ...s, color: PIE_COLORS[i % PIE_COLORS.length] }));
      // Add colors to expense categories
      const expCats = D.expenseCategories.map((c, i) => ({ ...c, color: PIE_COLORS[i % PIE_COLORS.length] }));

      const tabs = [
        { id: "overview", label: "Overview" },
        { id: "revenue", label: "Revenue" },
        { id: "channels", label: "Channels" },
        { id: "units", label: "Units" },
        { id: "expenses", label: "Expenses" },
        { id: "proforma", label: "Pro Forma 2026" },
        { id: "benchmark", label: "vs SB Market" },
      ];

      // NOI calcs
      const realizedNOI = S.totalToOwner - (S.totalExpenses > 0 ? S.totalExpenses : 0);

      return (
        <div style={{ fontFamily: "'Inter', -apple-system, BlinkMacSystemFont, sans-serif",
          background: COLORS.cream, minHeight: "100vh" }}>

          {/* Header */}
          <div style={{ background: COLORS.charcoal, padding: "28px 32px 20px", color: COLORS.white }}>
            <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", flexWrap: "wrap", gap: 12 }}>
              <div>
                <h1 style={{ margin: 0, fontSize: 26, fontWeight: 700, letterSpacing: -0.5 }}>
                  <span style={{ color: COLORS.gold }}>Casa Yano</span> Performance Dashboard
                </h1>
                <p style={{ margin: "6px 0 0", fontSize: 13, color: "#aaa" }}>
                  Opened {D.openingDate} &middot; {D.numUnits} Units &middot; Santa Barbara, CA
                  &middot; Updated {new Date(D.generatedAt).toLocaleDateString()}
                </p>
              </div>
              <div style={{ background: "rgba(198,151,63,0.15)", border: `1px solid ${COLORS.gold}`,
                borderRadius: 8, padding: "8px 16px", textAlign: "center" }}>
                <div style={{ fontSize: 11, color: COLORS.goldLight, fontWeight: 600,
                  textTransform: "uppercase", letterSpacing: 1 }}>Days Since Launch</div>
                <div style={{ fontSize: 28, fontWeight: 700, color: COLORS.gold }}>{D.daysSinceLaunch}</div>
              </div>
            </div>

            {/* Tabs */}
            <div style={{ display: "flex", gap: 4, marginTop: 20, flexWrap: "wrap" }}>
              {tabs.map(t => (
                <button key={t.id} onClick={() => setTab(t.id)} style={{
                  padding: "8px 18px", borderRadius: "8px 8px 0 0", border: "none",
                  background: tab === t.id ? COLORS.cream : "transparent",
                  color: tab === t.id ? COLORS.charcoal : "#999",
                  fontWeight: tab === t.id ? 700 : 500,
                  fontSize: 13, cursor: "pointer", transition: "all 0.2s",
                }}>{t.label}</button>
              ))}
            </div>
          </div>

          <div style={{ padding: "24px 32px", maxWidth: 1200, margin: "0 auto" }}>

            {/* ═══ OVERVIEW ═══ */}
            {tab === "overview" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 16, marginBottom: 32 }}>
                <KPICard label="Total Gross Revenue" value={fmtK(S.totalGross)} sub={`${S.totalBookings} total bookings`} accent={COLORS.gold} />
                <KPICard label="Owner Revenue" value={fmtK(S.totalToOwner)} sub={`${S.ownerMargin}% margin`} accent={COLORS.green} />
                <KPICard label="Blended ADR" value={fmt(S.blendedAdr)} sub={`vs $${D.config.sbMedianAdr} SB median`} accent={COLORS.blue} />
                <KPICard label="Avg Stay" value={`${S.avgStay} nights`} sub={`${S.avgLeadTime}-day avg lead time`} accent={COLORS.warmGray} />
                <KPICard label="Total Expenses" value={fmtK(S.totalExpenses)} sub="Tracked to date" accent={COLORS.red} />
                <KPICard label="Realized NOI" value={fmtK(realizedNOI)} sub="Owner rev minus tracked OpEx" accent={COLORS.gold} />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "2fr 1fr", gap: 24, marginBottom: 32 }}>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Monthly Revenue (To Owner)</SectionTitle>
                  <ResponsiveContainer width="100%" height={260}>
                    <ComposedChart data={D.monthlyData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="month" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmtK} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="toOwner" name="To Owner" fill={COLORS.gold} radius={[4,4,0,0]} />
                      <Line dataKey="adr" name="ADR" stroke={COLORS.blue} strokeWidth={2} dot={{ r: 3 }} />
                    </ComposedChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Booking Sources</SectionTitle>
                  <ResponsiveContainer width="100%" height={260}>
                    <PieChart>
                      <Pie data={sourceData} dataKey="bookings" nameKey="name" cx="50%" cy="50%"
                        outerRadius={85} innerRadius={45} paddingAngle={2} strokeWidth={0}>
                        {sourceData.map((entry, i) => <Cell key={i} fill={entry.color} />)}
                      </Pie>
                      <Tooltip formatter={(v, n) => [v + " bookings", n]} />
                      <Legend iconType="circle" iconSize={8}
                        formatter={(v) => <span style={{ fontSize: 11, color: COLORS.warmGray }}>{v}</span>} />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
              </div>
              {/* Launch velocity callout */}
              <div style={{ background: `linear-gradient(135deg, ${COLORS.charcoal}, #3a3a3a)`,
                borderRadius: 12, padding: 24, color: COLORS.white }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: COLORS.gold, marginBottom: 12 }}>Launch Velocity</div>
                <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 20 }}>
                  {[
                    { label: "Bookings/Day", value: (S.totalBookings / D.daysSinceLaunch).toFixed(1), note: `${S.totalBookings} in ${D.daysSinceLaunch} days` },
                    { label: "Gross Rev/Day", value: fmt(S.totalGross / D.daysSinceLaunch), note: "Run-rate pace" },
                    { label: "Annualized Gross", value: fmtK(S.totalGross / D.daysSinceLaunch * 365), note: "If current pace holds" },
                    { label: "Bookings/Unit/Week", value: (S.totalBookings / D.numUnits / (D.daysSinceLaunch / 7)).toFixed(1), note: "Across 6 units" },
                  ].map((item, i) => (
                    <div key={i} style={{ textAlign: "center" }}>
                      <div style={{ fontSize: 24, fontWeight: 700, color: COLORS.gold }}>{item.value}</div>
                      <div style={{ fontSize: 12, fontWeight: 600, color: COLORS.white, marginTop: 2 }}>{item.label}</div>
                      <div style={{ fontSize: 10, color: "#888", marginTop: 2 }}>{item.note}</div>
                    </div>
                  ))}
                </div>
              </div>
            </>)}

            {/* ═══ REVENUE ═══ */}
            {tab === "revenue" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 16, marginBottom: 24 }}>
                <KPICard label="Total Gross" value={fmtK(S.totalGross)} accent={COLORS.gold} />
                <KPICard label="Total To Owner" value={fmtK(S.totalToOwner)} accent={COLORS.green} />
                <KPICard label="Blended ADR" value={fmt(S.blendedAdr)} accent={COLORS.blue} />
                <KPICard label="Total Nights Sold" value={S.totalNights.toLocaleString()} accent={COLORS.warmGray} />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24 }}>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Revenue by Month</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={D.monthlyData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="month" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmtK} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="gross" name="Gross" fill={COLORS.goldLight} radius={[4,4,0,0]} />
                      <Bar dataKey="toOwner" name="To Owner" fill={COLORS.gold} radius={[4,4,0,0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>ADR Trend</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <LineChart data={D.monthlyData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="month" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmt} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Line dataKey="adr" name="ADR" stroke={COLORS.gold} strokeWidth={2.5} dot={{ r: 4, fill: COLORS.gold }} />
                    </LineChart>
                  </ResponsiveContainer>
                </div>
              </div>
            </>)}

            {/* ═══ CHANNELS ═══ */}
            {tab === "channels" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 16, marginBottom: 24 }}>
                <KPICard label="OTA Bookings" value={`${S.otaBookingPct}%`} sub={`${S.totalBookings - S.directBookings} of ${S.totalBookings}`} accent={COLORS.red} />
                <KPICard label="Direct Bookings" value={S.directBookings.toString()} sub={`${(100 - S.otaBookingPct).toFixed(1)}% of total`} accent={COLORS.green} />
                <KPICard label="Avg OTA Commission" value={`${S.otaPct}%`} sub="Blended rate" accent={COLORS.blue} />
                <KPICard label="Repeat Guests" value={`${S.repeatGuestPct}%`} sub="Multiple bookings" accent={COLORS.warmGray} />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24, marginBottom: 24 }}>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Bookings by Source</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <PieChart>
                      <Pie data={sourceData} dataKey="bookings" nameKey="name" cx="50%" cy="50%"
                        outerRadius={100} innerRadius={50} paddingAngle={2} strokeWidth={0}>
                        {sourceData.map((entry, i) => <Cell key={i} fill={entry.color} />)}
                      </Pie>
                      <Tooltip formatter={(v, n) => [v + " bookings", n]} />
                      <Legend iconType="circle" iconSize={8} />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Revenue by Source</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={sourceData} layout="vertical">
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis type="number" tickFormatter={fmtK} fontSize={11} />
                      <YAxis type="category" dataKey="name" width={100} fontSize={11} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="revenue" name="Revenue" radius={[0,4,4,0]}>
                        {sourceData.map((entry, i) => <Cell key={i} fill={entry.color} />)}
                      </Bar>
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>
              {/* Channel detail table */}
              <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                <SectionTitle>Channel Performance</SectionTitle>
                <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
                  <thead>
                    <tr style={{ borderBottom: `2px solid ${COLORS.gold}` }}>
                      {["Source", "Bookings", "% of Total", "Revenue", "Avg/Booking"].map(h => (
                        <th key={h} style={{ padding: "8px 12px", textAlign: "left", fontWeight: 700,
                          fontSize: 12, textTransform: "uppercase", letterSpacing: 0.5 }}>{h}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {sourceData.map((s, i) => (
                      <tr key={i} style={{ borderBottom: `1px solid ${COLORS.lightGray}` }}>
                        <td style={{ padding: "10px 12px", fontWeight: 600 }}>
                          <span style={{ display: "inline-block", width: 10, height: 10, borderRadius: "50%",
                            background: s.color, marginRight: 8, verticalAlign: "middle" }} />
                          {s.name}
                        </td>
                        <td style={{ padding: "10px 12px" }}>{s.bookings}</td>
                        <td style={{ padding: "10px 12px" }}>{s.pct}%</td>
                        <td style={{ padding: "10px 12px", fontWeight: 600, color: COLORS.gold }}>{fmt(s.revenue)}</td>
                        <td style={{ padding: "10px 12px" }}>{s.bookings ? fmt(s.revenue / s.bookings) : "—"}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </>)}

            {/* ═══ UNITS ═══ */}
            {tab === "units" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(170px, 1fr))", gap: 16, marginBottom: 24 }}>
                {D.unitData.map((u, i) => {
                  const best = D.unitData.reduce((a, b) => a.toOwner > b.toOwner ? a : b);
                  const isBest = u.unit === best.unit;
                  return (
                    <div key={i} style={{
                      background: COLORS.white, borderRadius: 12, padding: 20,
                      boxShadow: "0 1px 3px rgba(0,0,0,0.06)",
                      borderLeft: `4px solid ${isBest ? COLORS.gold : COLORS.lightGray}`,
                    }}>
                      <div style={{ fontSize: 14, fontWeight: 700, color: COLORS.charcoal, marginBottom: 8 }}>{u.unit}</div>
                      <div style={{ fontSize: 22, fontWeight: 700, color: COLORS.gold }}>{fmt(u.toOwner)}</div>
                      <div style={{ fontSize: 11, color: COLORS.warmGray, marginTop: 4 }}>
                        {u.bookings} bookings &middot; ${u.adr} ADR &middot; {u.avgStay}n avg
                      </div>
                      {isBest && <div style={{ fontSize: 10, color: COLORS.gold, fontWeight: 700, marginTop: 6 }}>TOP PERFORMER</div>}
                    </div>
                  );
                })}
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24 }}>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Revenue by Unit</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={D.unitData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="unit" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmtK} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="toOwner" name="To Owner" fill={COLORS.gold} radius={[4,4,0,0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>ADR by Unit</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={D.unitData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="unit" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmt} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="adr" name="ADR" fill={COLORS.blue} radius={[4,4,0,0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>
            </>)}

            {/* ═══ EXPENSES ═══ */}
            {tab === "expenses" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 16, marginBottom: 24 }}>
                <KPICard label="Total Expenses" value={fmtK(S.totalExpenses)} accent={COLORS.red} />
                <KPICard label="Cost per Turn" value={fmt(S.costPerTurn)} sub="Cleaning cost/booking" accent={COLORS.warmGray} />
              </div>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24, marginBottom: 24 }}>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Expense Breakdown</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <PieChart>
                      <Pie data={expCats} dataKey="amount" nameKey="category" cx="50%" cy="50%"
                        outerRadius={100} innerRadius={50} paddingAngle={2} strokeWidth={0}>
                        {expCats.map((entry, i) => <Cell key={i} fill={entry.color} />)}
                      </Pie>
                      <Tooltip formatter={(v, n) => [fmt(v), n]} />
                      <Legend iconType="circle" iconSize={8}
                        formatter={(v) => <span style={{ fontSize: 11, color: COLORS.warmGray }}>{v}</span>} />
                    </PieChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Monthly Expenses</SectionTitle>
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={D.expenseMonthly}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="month" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmtK} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="cleaning" name="Cleaning" stackId="a" fill={PIE_COLORS[0]} />
                      <Bar dataKey="supplies" name="Supplies" stackId="a" fill={PIE_COLORS[1]} />
                      <Bar dataKey="capex" name="CapEx" stackId="a" fill={PIE_COLORS[2]} />
                      <Bar dataKey="marketing" name="Marketing" stackId="a" fill={PIE_COLORS[3]} />
                      <Bar dataKey="maint" name="Maintenance" stackId="a" fill={PIE_COLORS[5]} />
                      <Bar dataKey="other" name="Other" stackId="a" fill={PIE_COLORS[6]} radius={[4,4,0,0]} />
                    </BarChart>
                  </ResponsiveContainer>
                </div>
              </div>
              {/* Top Vendors */}
              <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                <SectionTitle>Top Vendors</SectionTitle>
                <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
                  <thead>
                    <tr style={{ borderBottom: `2px solid ${COLORS.gold}` }}>
                      {["Vendor", "Category", "Total Spend", "% of Total"].map(h => (
                        <th key={h} style={{ padding: "8px 12px", textAlign: "left", fontWeight: 700,
                          fontSize: 12, textTransform: "uppercase", letterSpacing: 0.5 }}>{h}</th>
                      ))}
                    </tr>
                  </thead>
                  <tbody>
                    {D.topVendors.map((v, i) => (
                      <tr key={i} style={{ borderBottom: `1px solid ${COLORS.lightGray}` }}>
                        <td style={{ padding: "10px 12px", fontWeight: 600 }}>{v.vendor}</td>
                        <td style={{ padding: "10px 12px", color: COLORS.warmGray }}>{v.category}</td>
                        <td style={{ padding: "10px 12px", fontWeight: 600, color: COLORS.red }}>{fmt(v.amount)}</td>
                        <td style={{ padding: "10px 12px" }}>{S.totalExpenses ? (v.amount / S.totalExpenses * 100).toFixed(1) : 0}%</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </>)}

            {/* ═══ PRO FORMA 2026 ═══ */}
            {tab === "proforma" && (<>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(170px, 1fr))", gap: 16, marginBottom: 24 }}>
                <KPICard label="Gross Revenue" value={fmtK(PF.gross)} sub={`${D.numUnits} units x ${PF.avgOcc}% occ x $${PF.avgAdr} ADR`} accent={COLORS.gold} />
                <KPICard label="Net to Owner" value={fmtK(PF.netOwner)} sub={`${(PF.netOwner / PF.gross * 100).toFixed(1)}% margin`} accent={COLORS.green} />
                <KPICard label="Known OpEx" value={fmtK(PF.opex + PF.mgmtFee + PF.propertyTax + PF.insurance + (PF.otherFixed || 0))}
                  sub="Direct + mgmt + tax + ins" accent={COLORS.red} />
                <KPICard label="NOI (After Known Fixed)" value={fmtK(PF.noiAfterKnown)}
                  sub={`${(PF.noiAfterKnown / PF.gross * 100).toFixed(1)}% NOI margin`} accent={COLORS.gold} />
                <KPICard label="Blended ADR" value={fmt(PF.avgAdr)} accent={COLORS.blue} />
                <KPICard label="Avg Occupancy" value={`${PF.avgOcc}%`} accent={COLORS.warmGray} />
              </div>

              {/* Monthly P&L + Seasonal curves */}
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24, marginBottom: 24 }}>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Monthly P&L Forecast</SectionTitle>
                  <ResponsiveContainer width="100%" height={280}>
                    <ComposedChart data={PF.monthly}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="month" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis tickFormatter={fmtK} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="gross" name="Gross Revenue" fill={COLORS.gold} opacity={0.3} radius={[4,4,0,0]} />
                      <Bar dataKey="netOwner" name="Net to Owner" fill={COLORS.gold} radius={[4,4,0,0]} />
                      <Bar dataKey="opex" name="OpEx" fill={COLORS.red} opacity={0.6} radius={[4,4,0,0]} />
                      <Line dataKey="noi" name="NOI" stroke={COLORS.green} strokeWidth={2.5} dot={{ r: 3, fill: COLORS.green }} />
                    </ComposedChart>
                  </ResponsiveContainer>
                </div>
                <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)" }}>
                  <SectionTitle>Seasonal ADR & Occupancy</SectionTitle>
                  <ResponsiveContainer width="100%" height={280}>
                    <ComposedChart data={PF.monthly}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#eee" />
                      <XAxis dataKey="month" fontSize={11} tick={{ fill: COLORS.warmGray }} />
                      <YAxis yAxisId="left" tickFormatter={fmt} fontSize={11} tick={{ fill: COLORS.warmGray }} domain={[300, 600]} />
                      <YAxis yAxisId="right" orientation="right" tickFormatter={(v) => v + "%"} fontSize={11} tick={{ fill: COLORS.warmGray }} domain={[60, 90]} />
                      <Tooltip content={<CustomTooltip />} />
                      <Bar dataKey="adr" name="ADR" fill={COLORS.gold} yAxisId="left" radius={[4,4,0,0]} />
                      <Line dataKey="occ" name="Occupancy %" stroke={COLORS.blue} strokeWidth={2.5} yAxisId="right" dot={{ r: 3, fill: COLORS.blue }} />
                    </ComposedChart>
                  </ResponsiveContainer>
                </div>
              </div>

              {/* Waterfall */}
              <div style={{ background: COLORS.white, borderRadius: 12, padding: 24, boxShadow: "0 1px 3px rgba(0,0,0,0.06)", marginBottom: 24 }}>
                <SectionTitle>Revenue Waterfall: Gross → NOI</SectionTitle>
                <ResponsiveContainer width="100%" height={320}>
                  <BarChart data={PF.waterfall.map(w => ({ ...w, absValue: Math.abs(w.value) }))} layout="vertical" margin={{ left: 20, right: 40 }}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#eee" horizontal={false} />
                    <XAxis type="number" tickFormatter={fmtK} fontSize={11} tick={{ fill: COLORS.warmGray }} />
                    <YAxis type="category" dataKey="name" width={170} fontSize={11} tick={{ fill: COLORS.charcoal, fontWeight: 600 }} />
                    <Tooltip formatter={(v, n, p) => [fmt(Math.abs(p.payload.value)), p.payload.value < 0 ? "Deduction" : "Total"]} />
                    <Bar dataKey="absValue" name="Amount" radius={[0,4,4,0]}>
                      {PF.waterfall.map((entry, i) => {
                        const fills = { positive: COLORS.gold, negative: COLORS.red, subtotal: COLORS.green,
                          opex: "#C47D4D", mgmt: "#9C27B0", total: COLORS.green };
                        return <Cell key={i} fill={fills[entry.type] || COLORS.gold} />;
                      })}
                    </Bar>
                  </BarChart>
                </ResponsiveContainer>
              </div>

              {/* P&L Summary */}
              <div style={{ background: `linear-gradient(135deg, ${COLORS.charcoal}, #3a3a3a)`,
                borderRadius: 12, padding: 24, color: COLORS.white }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: COLORS.gold, marginBottom: 16 }}>
                  Annual P&L Summary — 2026 Pro Forma
                </div>
                <table style={{ width: "100%", borderCollapse: "collapse", fontSize: 13 }}>
                  <tbody>
                    {[
                      { label: "Gross Revenue", value: fmt(PF.gross), pct: "100%", bold: true, color: COLORS.gold },
                      { label: "  OTA Commissions", value: `(${fmt(Math.abs(PF.waterfall.find(w => w.name.includes("OTA"))?.value || 0))})`, indent: true },
                      { label: "  Taxes — TOT", value: `(${fmt(Math.abs(PF.waterfall.find(w => w.name.includes("Tax"))?.value || 0))})`, indent: true },
                      { label: "  Processing Fees", value: `(${fmt(Math.abs(PF.waterfall.find(w => w.name.includes("Process"))?.value || 0))})`, indent: true },
                      { label: "Net to Owner", value: fmt(PF.netOwner), pct: `${(PF.netOwner/PF.gross*100).toFixed(1)}%`, bold: true, color: COLORS.green, sep: true },
                      { label: "  Direct OpEx (cleaning, supplies, etc.)", value: `(${fmt(PF.opex)})`, indent: true },
                      { label: "  Management Fee (10%)", value: `(${fmt(PF.mgmtFee)})`, indent: true },
                      { label: "  Property Tax", value: `(${fmt(PF.propertyTax)})`, indent: true },
                      { label: "  Insurance", value: `(${fmt(PF.insurance)})`, indent: true },
                      { label: "  Other Fixed (internet, bookkeeping, etc.)", value: `(${fmt(PF.otherFixed || 0)})`, indent: true },
                      { label: "NOI (After Known Fixed Costs)", value: fmt(PF.noiAfterKnown),
                        pct: `${(PF.noiAfterKnown/PF.gross*100).toFixed(1)}%`, bold: true, color: COLORS.gold, sep: true },
                    ].map((row, i) => (
                      <tr key={i} style={{ borderTop: row.sep ? "1px solid #555" : "none" }}>
                        <td style={{ padding: row.bold ? "10px 12px" : "6px 12px 6px 24px",
                          fontWeight: row.bold ? 700 : 400, color: row.indent ? "#aaa" : COLORS.white,
                          fontSize: row.bold ? 13 : 12 }}>{row.label}</td>
                        <td style={{ padding: "6px 12px", textAlign: "right",
                          fontWeight: row.bold ? 700 : 500, color: row.color || "#ccc",
                          fontSize: row.bold ? 14 : 12 }}>{row.value}</td>
                        <td style={{ padding: "6px 12px", textAlign: "right",
                          color: "#888", fontSize: 12 }}>{row.pct || ""}</td>
                      </tr>
                    ))}
                  </tbody>
                </table>
                <div style={{ fontSize: 11, color: "#666", marginTop: 16, fontStyle: "italic" }}>
                  Model driven by actual performance data. Seasonal adjustments per SB market patterns.
                </div>
              </div>
            </>)}

            {/* ═══ BENCHMARK ═══ */}
            {tab === "benchmark" && (<>
              <div style={{ background: COLORS.white, borderRadius: 12, padding: 24,
                boxShadow: "0 1px 3px rgba(0,0,0,0.06)", marginBottom: 24 }}>
                <SectionTitle>Casa Yano vs Santa Barbara STR Market</SectionTitle>
                <p style={{ fontSize: 13, color: COLORS.warmGray, marginBottom: 20, lineHeight: 1.6 }}>
                  Comparison based on publicly available SB STR market data.
                </p>
                <CompBar label="Average Daily Rate" value={S.blendedAdr} max={600} format={fmt}
                  color={COLORS.gold} benchmark={D.config.sbMedianAdr} benchLabel="SB Median" />
                <CompBar label="Owner Margin %" value={S.ownerMargin} max={100} format={v => v + "%"}
                  color={COLORS.green} benchmark={75} benchLabel="SB Typical" />
                <CompBar label="OTA Commission Rate" value={S.otaPct} max={20} format={v => v + "%"}
                  color={COLORS.blue} benchmark={15} benchLabel="Industry Avg" />
              </div>

              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 24, marginBottom: 24 }}>
                <div style={{ background: COLORS.greenLight, borderRadius: 12, padding: 24, border: `1px solid ${COLORS.green}33` }}>
                  <div style={{ fontSize: 14, fontWeight: 700, color: COLORS.green, marginBottom: 12 }}>Strengths</div>
                  {[
                    `ADR ${Math.round((S.blendedAdr - D.config.sbMedianAdr) / D.config.sbMedianAdr * 100)}% above SB median`,
                    `${S.ownerMargin}% owner margin — exceptional cost efficiency`,
                    `${S.otaPct}% blended OTA commission vs 15% industry standard`,
                    `${S.totalBookings} bookings in ${D.daysSinceLaunch} days — strong launch`,
                  ].map((s, i) => (
                    <div key={i} style={{ fontSize: 12, color: COLORS.charcoal, marginBottom: 8, paddingLeft: 16,
                      position: "relative", lineHeight: 1.5 }}>
                      <span style={{ position: "absolute", left: 0, color: COLORS.green, fontWeight: 700 }}>+</span>{s}
                    </div>
                  ))}
                </div>
                <div style={{ background: COLORS.redLight, borderRadius: 12, padding: 24, border: `1px solid ${COLORS.red}33` }}>
                  <div style={{ fontSize: 14, fontWeight: 700, color: COLORS.red, marginBottom: 12 }}>Watch List</div>
                  {[
                    `${S.otaBookingPct}% OTA dependency — platform risk + commission drag`,
                    `Direct bookings only ${(100 - S.otaBookingPct).toFixed(0)}% — biggest margin lever`,
                    `Repeat guest rate at ${S.repeatGuestPct}% — early days, build loyalty`,
                  ].map((s, i) => (
                    <div key={i} style={{ fontSize: 12, color: COLORS.charcoal, marginBottom: 8, paddingLeft: 16,
                      position: "relative", lineHeight: 1.5 }}>
                      <span style={{ position: "absolute", left: 0, color: COLORS.red, fontWeight: 700 }}>!</span>{s}
                    </div>
                  ))}
                </div>
              </div>

              <div style={{ background: `linear-gradient(135deg, ${COLORS.charcoal}, #3a3a3a)`,
                borderRadius: 12, padding: 24, color: COLORS.white }}>
                <div style={{ fontSize: 14, fontWeight: 700, color: COLORS.gold, marginBottom: 12 }}>Annualized Projection (if current pace holds)</div>
                <div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit, minmax(180px, 1fr))", gap: 20 }}>
                  {[
                    { label: "Annualized Gross", value: fmtK(S.totalGross / D.daysSinceLaunch * 365), note: `Based on ${fmtK(S.totalGross)} / ${D.daysSinceLaunch} days` },
                    { label: "Annualized To Owner", value: fmtK(S.totalToOwner / D.daysSinceLaunch * 365), note: `At ${S.ownerMargin}% margin` },
                    { label: "Annualized Bookings", value: `~${Math.round(S.totalBookings / D.daysSinceLaunch * 365).toLocaleString()}`, note: "At current pace" },
                  ].map((item, i) => (
                    <div key={i} style={{ textAlign: "center" }}>
                      <div style={{ fontSize: 24, fontWeight: 700, color: COLORS.gold }}>{item.value}</div>
                      <div style={{ fontSize: 12, fontWeight: 600, color: COLORS.white, marginTop: 2 }}>{item.label}</div>
                      <div style={{ fontSize: 10, color: "#888", marginTop: 2 }}>{item.note}</div>
                    </div>
                  ))}
                </div>
                <div style={{ fontSize: 11, color: "#666", marginTop: 16, fontStyle: "italic" }}>
                  Note: Annualized figures assume current pace continues year-round. Actual results will vary seasonally.
                </div>
              </div>
            </>)}

          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(CasaYanoDashboard));
  </script>
</body>
</html>
